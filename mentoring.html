<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Наставничество - HR RMRP "Рублевка"</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>HR RMRP "Рублевка"</h1>
                <p>Профессиональные решения для управления персоналом</p>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Главная</a></li>
                    <li><a href="faq.html">FAQ HR</a></li>
                    <li><a href="mentoring.html" class="active">Наставничество</a></li>
                    <li><a href="priorities.html">Приоритетные задачи</a></li>
                    <li><a href="team.html">Состав HR</a></li>
                    <li><a href="events.html">Мероприятия</a></li>
                    <li><a href="trainings.html">Тренинги и лекции</a></li>
                    <li><a href="reports.html">Отчетность</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="page-header">
        <div class="container">
            <h1>Наставничество</h1>
        </div>
    </section>

    <main class="page-content">
        <div class="container" id="mentoring-container">
            <!-- Исходный контент Наставничество -->
            <table>
                <tr class="header-row">
                    <td colspan="13">Руководитель: Матвей Корж</td>
                    <td>Начало: <strong>17.07.2025</strong></td>
                </tr>
                <tr>
                    <th>Модераторы/Администраторы</th>
                    <th>ID</th>
                    <th>Дата вступления</th>
                    <th>HR-куратор 1</th>
                    <th>HR-куратор 2</th>
                    <th>Дата повышения на 1 уровень</th>
                    <th>Дата повышения на 2 уровень</th>
                    <th>Правила</th>
                    <th>Этика</th>
                    <th>Discord</th>
                    <th>Иерархия</th>
                    <th>Основы</th>
                    <th>Комментарий</th>
                    <th>Зарплата 0-1 ур. выплачена</th>
                    <th>Зарплата 1-2 ур. выплачена</th>
                </tr>
                <tbody id="mentoring-table-body">
                    <!-- Данные из API будут загружены сюда -->
                </tbody>
            </table>
        </div>
        <div class="container" id="mentoring-editor" style="display:none;">
            <h2>Редактирование Наставничества</h2>
            <form id="mentoring-form">
                <div id="mentoring-items"></div>
                <button type="button" id="add-mentoring-item">Добавить запись</button>
                <br/><br/>
                <button type="submit">Сохранить изменения</button>
                <button type="button" id="cancel-mentoring-edit">Отмена</button>
            </form>
        </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 HR RMRP "Рублевка". Все права защищены.</p>
        </div>
    </footer>

    <script>
        const mentoringApiUrl = '/.netlify/functions/mentoring';
        const authToken = 'secret-token';

        const mentoringContainer = document.getElementById('mentoring-container');
        const mentoringEditor = document.getElementById('mentoring-editor');
        const mentoringForm = document.getElementById('mentoring-form');
        const mentoringItemsDiv = document.getElementById('mentoring-items');
        const addMentoringItemBtn = document.getElementById('add-mentoring-item');
        const cancelMentoringEditBtn = document.getElementById('cancel-mentoring-edit');

        let mentoringData = [];

        async function fetchMentoring() {
            const res = await fetch(mentoringApiUrl);
            mentoringData = await res.json();
            renderMentoring();
        }

        function renderMentoring() {
            const tbody = document.getElementById('mentoring-table-body');
            tbody.innerHTML = '';
            mentoringData.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'green-row' : 'red-row';

                tr.innerHTML = `
                    <td class="left-align"><input type="text" value="${item.moderator}" disabled></td>
                    <td><input type="text" value="${item.id}" disabled></td>
                    <td><input type="date" value="${item.joinDate}" disabled></td>
                    <td><input type="text" value="${item.hrCurator1}" disabled></td>
                    <td><input type="text" value="${item.hrCurator2}" disabled></td>
                    <td><input type="date" value="${item.promotionDate1}" disabled></td>
                    <td><input type="date" value="${item.promotionDate2}" disabled></td>
                    <td><input type="checkbox" ${item.rules ? 'checked' : ''} disabled></td>
                    <td><input type="checkbox" ${item.ethics ? 'checked' : ''} disabled></td>
                    <td><input type="checkbox" ${item.discord ? 'checked' : ''} disabled></td>
                    <td><input type="checkbox" ${item.hierarchy ? 'checked' : ''} disabled></td>
                    <td><input type="checkbox" ${item.basics ? 'checked' : ''} disabled></td>
                    <td><input type="text" value="${item.comment}" disabled></td>
                    <td><input type="checkbox" ${item.salary01 ? 'checked' : ''} disabled></td>
                    <td><input type="checkbox" ${item.salary12 ? 'checked' : ''} disabled></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderMentoringEditor() {
            mentoringItemsDiv.innerHTML = '';
            mentoringData.forEach((item, index) => {
                const div = document.createElement('div');
                div.style.marginBottom = '1rem';

                div.innerHTML = `
                    <input type="text" name="moderator" value="${item.moderator}" placeholder="Модератор/Администратор" required>
                    <input type="text" name="id" value="${item.id}" placeholder="ID" required>
                    <input type="date" name="joinDate" value="${item.joinDate}" required>
                    <input type="text" name="hrCurator1" value="${item.hrCurator1}" placeholder="HR-куратор 1" required>
                    <input type="text" name="hrCurator2" value="${item.hrCurator2}" placeholder="HR-куратор 2">
                    <input type="date" name="promotionDate1" value="${item.promotionDate1}">
                    <input type="date" name="promotionDate2" value="${item.promotionDate2}">
                    <label><input type="checkbox" name="rules" ${item.rules ? 'checked' : ''}> Правила</label>
                    <label><input type="checkbox" name="ethics" ${item.ethics ? 'checked' : ''}> Этика</label>
                    <label><input type="checkbox" name="discord" ${item.discord ? 'checked' : ''}> Discord</label>
                    <label><input type="checkbox" name="hierarchy" ${item.hierarchy ? 'checked' : ''}> Иерархия</label>
                    <label><input type="checkbox" name="basics" ${item.basics ? 'checked' : ''}> Основы</label>
                    <input type="text" name="comment" value="${item.comment}" placeholder="Комментарий">
                    <label><input type="checkbox" name="salary01" ${item.salary01 ? 'checked' : ''}> Зарплата 0-1 ур. выплачена</label>
                    <label><input type="checkbox" name="salary12" ${item.salary12 ? 'checked' : ''}> Зарплата 1-2 ур. выплачена</label>
                `;
                mentoringItemsDiv.appendChild(div);
            });
        }

        addMentoringItemBtn.addEventListener('click', () => {
            mentoringData.push({
                moderator: '',
                id: '',
                joinDate: '',
                hrCurator1: '',
                hrCurator2: '',
                promotionDate1: '',
                promotionDate2: '',
                rules: false,
                ethics: false,
                discord: false,
                hierarchy: false,
                basics: false,
                comment: '',
                salary01: false,
                salary12: false
            });
            renderMentoringEditor();
        });

        mentoringForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newData = [];
            const children = mentoringItemsDiv.children;
            for (let i = 0; i < children.length; i++) {
                const inputs = children[i].querySelectorAll('input');
                newData.push({
                    moderator: inputs[0].value.trim(),
                    id: inputs[1].value.trim(),
                    joinDate: inputs[2].value,
                    hrCurator1: inputs[3].value.trim(),
                    hrCurator2: inputs[4].value.trim(),
                    promotionDate1: inputs[5].value,
                    promotionDate2: inputs[6].value,
                    rules: inputs[7].checked,
                    ethics: inputs[8].checked,
                    discord: inputs[9].checked,
                    hierarchy: inputs[10].checked,
                    basics: inputs[11].checked,
                    comment: inputs[12].value.trim(),
                    salary01: inputs[13].checked,
                    salary12: inputs[14].checked
                });
            }
            const res = await fetch(mentoringApiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + authToken
                },
                body: JSON.stringify(newData)
            });
            if (res.ok) {
                mentoringData = newData;
                mentoringEditor.style.display = 'none';
                mentoringContainer.style.display = 'block';
                renderMentoring();
            } else {
                alert('Ошибка при сохранении данных');
            }
        });

        cancelMentoringEditBtn.addEventListener('click', () => {
            mentoringEditor.style.display = 'none';
            mentoringContainer.style.display = 'block';
            renderMentoring();
        });

        mentoringContainer.addEventListener('dblclick', () => {
            mentoringEditor.style.display = 'block';
            mentoringContainer.style.display = 'none';
            renderMentoringEditor();
        });

        fetchMentoring();
    </script>
